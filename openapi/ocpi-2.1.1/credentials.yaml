openapi: 3.1.0
info:
  title: OCPI 2.1.1 - Credentials
  description: "The credentials module is used to exchange the credentials token
    that has to be used by parties for authorization of requests. This module is
    symmetric: every implementation needs to be able to call and handle requests
    to this module."
  version: 2.1.1
  license:
    name: Creative Commons Attribution-NoDerivatives 4.0 International
    url: https://creativecommons.org/licenses/by-nd/4.0/
externalDocs:
  description: OCPI 2.1.1 Specification
  url: https://github.com/ocpi/ocpi
servers:
  - url: https://example.com/ocpi/2.1.1
    description: Example OCPI server
security:
  - TokenAuth: []
paths:
  /credentials:
    get:
      operationId: getCredentials
      summary: Get Credentials
      description: Retrieves the credentials object to access the server's platform.
        The response contains the credentials object with business details.
      tags:
        - Credentials
      responses:
        "200":
          description: The credentials to access this platform.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CredentialsResponse"
        "401":
          description: Unauthorized - Missing or invalid credentials token.
    post:
      operationId: postCredentials
      summary: Register (Credentials Exchange)
      description: Provides the server with credentials to access the client's system
        (registration). If successful, the server generates a new credentials
        token and responds with the client's new credentials to access the
        server's system. Returns HTTP 405 if the client has already been
        registered.
      tags:
        - Credentials
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Credentials"
      responses:
        "200":
          description: Registration successful. Contains new credentials to access the
            server.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CredentialsResponse"
        "401":
          description: Unauthorized - Missing or invalid credentials token.
        "405":
          description: Method not allowed - Client has already been registered.
    put:
      operationId: putCredentials
      summary: Update Credentials
      description: Provides the server with updated credentials to access the client's
        system. A PUT will switch to the version that contains this credentials
        endpoint if different. The server must fetch the client's endpoints
        again. Returns HTTP 405 if the client has not been registered yet.
      tags:
        - Credentials
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Credentials"
      responses:
        "200":
          description: Credentials updated. Contains new credentials to access the server.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CredentialsResponse"
        "401":
          description: Unauthorized - Missing or invalid credentials token.
        "405":
          description: Method not allowed - Client has not been registered yet.
    delete:
      operationId: deleteCredentials
      summary: Unregister
      description: Informs the server that its credentials to access the client's
        system are now invalid. Both parties must end any automated
        communication. Returns HTTP 405 if the client has not been registered.
      tags:
        - Credentials
      responses:
        "200":
          description: Unregistration successful.
          content:
            application/json:
              schema:
                $ref: ./shared/common.yaml#/components/schemas/OcpiResponse
        "401":
          description: Unauthorized - Missing or invalid credentials token.
        "405":
          description: Method not allowed - Client has not been registered.
components:
  securitySchemes:
    TokenAuth:
      type: apiKey
      in: header
      name: Authorization
      description: OCPI credentials token passed in the Authorization header.
  schemas:
    CredentialsResponse:
      type: object
      required:
        - status_code
        - timestamp
        - data
      properties:
        data:
          $ref: "#/components/schemas/Credentials"
        status_code:
          type: integer
          description: OCPI status code (1xxx=success, 2xxx=client error, 3xxx=server
            error, 4xxx=hub error).
          example: 1000
        status_message:
          type: string
          description: An optional status message which may help when debugging.
        timestamp:
          $ref: ./shared/schemas/types.yaml#/components/schemas/DateTime
      additionalProperties: true
    Credentials:
      type: object
      description: Credentials object containing the token, versions URL, and party
        identity.
      required:
        - token
        - url
        - business_details
        - party_id
        - country_code
      properties:
        token:
          type: string
          maxLength: 64
          description: The token for the other party to authenticate in your system.
        url:
          type: string
          format: uri
          maxLength: 255
          description: The URL to your API versions endpoint.
        business_details:
          $ref: ./shared/schemas/locations.yaml#/components/schemas/BusinessDetails
        party_id:
          type: string
          maxLength: 3
          description: CPO or eMSP ID of this party (following ISO-15118).
        country_code:
          type: string
          maxLength: 2
          description: ISO-3166 alpha-2 country code of the country this party is
            operating in.
      additionalProperties: true
